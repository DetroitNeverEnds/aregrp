name: Storybook Build

on:
    workflow_call:
    workflow_dispatch:

defaults:
    run:
        working-directory: frontend

jobs:
    build-storybook:
        name: Build Storybook
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: "20"
                  cache: "npm"
                  cache-dependency-path: frontend/package-lock.json

            - name: Install dependencies
              run: npm ci

            - name: Build Storybook
              run: npm run build-storybook

            - name: Upload Storybook artifacts
              uses: actions/upload-artifact@v4
              with:
                  name: storybook-static
                  path: frontend/storybook-static
                  retention-days: 7

            - name: Check build size
              run: |
                  echo "Storybook build size:"
                  du -sh storybook-static
                  echo "Detailed breakdown:"
                  du -h storybook-static/* | sort -h
